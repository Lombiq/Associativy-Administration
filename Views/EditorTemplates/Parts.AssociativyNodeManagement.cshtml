@model Associativy.Administration.Models.AssociativyNodeManagementPart
@{
    Script.Require("jQueryUI_Tabs").AtFoot();
    Script.Require("AssociativyAutoComplete").AtFoot();
    Style.Require("jQueryUI_Orchard");
}
<fieldset>
    <legend>@T("Associativy graph settings")</legend>
    <div id="associativy-tabs">
        <ul>
            @foreach (var provider in Model.GraphDescriptors)
            {
                <text><li><a href="#associativy-tabs-@provider.GraphName">@provider.DisplayGraphName.Text</a></li></text>
            }
        </ul>
        @{
            int labelsIndex = 0;
        }
        @foreach (var provider in Model.GraphDescriptors)
        {
            <text>
            <div id="associativy-tabs-@provider.GraphName">
                <fieldset>
                    <legend>@T("Edit connections")</legend>
                    <ol>
                        <li>
                            @Html.Label("NeighbourLabels[" + labelsIndex + "]", T("Neighbours").Text)
                            @Html.TextBox("NeighbourLabels[" + labelsIndex + "]", Model.NeighbourLabels[labelsIndex], new { @class = "text large" })
                        </li>
                    </ol>
                </fieldset>
            </div>
            @using (Script.Foot())
            {
                <script>
                    $(function () {
                        @*Is there a better way to get the textbox's id? *@
                        $.associativyAutoComplete.terms($("#associativy-tabs-@provider.GraphName").find("input[type=text]").attr("id"), "@Url.RouteUrl("Associativy.Frontends.AutoComplete.FetchSimilarLabels", new { GraphName = Model.GraphContexts[provider].GraphName })");
                    });
                </script>
            }
            </text>
            labelsIndex++;
        }
    </div>
</fieldset>
@using (Script.Foot())
{
    <script>
        $(function () {
            $("#associativy-tabs").tabs();
        });
    </script>
}